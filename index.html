<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÖ Fechado QCC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 650px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            padding: 15px;
        }

        header {
            background: linear-gradient(135deg, #8bc34a 0%, #689f38 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .calculator {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2e7d32;
            font-size: 0.95rem;
        }

        .search-container {
            position: relative;
        }

        #insumoSearch {
            width: 100%;
            padding: 12px;
            border: 2px solid #c8e6c9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        #insumoSearch:focus {
            outline: none;
            border-color: #8bc34a;
            box-shadow: 0 0 0 3px rgba(139, 195, 74, 0.2);
        }

        #insumoSearch::placeholder {
            color: #a5d6a7;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #8bc34a;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 5px;
            box-shadow: 0 5px 15px rgba(139, 195, 74, 0.3);
            display: none;
        }

        .suggestion-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #e8f5e9;
            transition: background 0.2s;
        }

        .suggestion-item:hover {
            background: #f1f8e9;
        }

        .suggestion-item strong {
            color: #2e7d32;
            display: block;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .suggestion-item span {
            font-size: 0.85rem;
            color: #689f38;
        }

        #insumoSelect {
            width: 100%;
            padding: 12px;
            border: 2px solid #c8e6c9;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            background: white;
            margin-top: 10px;
            transition: border-color 0.3s;
        }

        #insumoSelect:focus {
            outline: none;
            border-color: #8bc34a;
            box-shadow: 0 0 0 3px rgba(139, 195, 74, 0.2);
        }

        /* Ajuste para el campo de fecha */
        #fechaIngreso {
            width: 100%;
            padding: 12px;
            border: 2px solid #c8e6c9;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: border-color 0.3s;
            background: #e8f5e9;
            text-align: center;
            color: #2e7d32;
        }

        #fechaIngreso:focus {
            outline: none;
            border-color: #8bc34a;
            box-shadow: 0 0 0 3px rgba(139, 195, 74, 0.2);
        }

        /* Para que el selector de fecha no se vea tan alto en m√≥viles */
        @media (max-width: 600px) {
            #fechaIngreso {
                height: auto;
                line-height: 1.5;
                padding: 12px 10px;
                font-size: 1rem;
                text-align: center;
            }
        }

        .switch-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .switch-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #c8e6c9;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            color: #689f38;
        }

        .switch-btn.active {
            background: #8bc34a;
            color: white;
            border-color: #8bc34a;
        }

        .switch-btn:hover:not(.active) {
            background: #f1f8e9;
            border-color: #8bc34a;
            color: #2e7d32;
        }

        .input-section {
            display: none;
        }

        .input-section.active {
            display: block;
        }

        .result-box {
            background: #f1f8e9;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
            border: 2px solid #c5e1a5;
            display: none;
        }

        .result-box.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-title {
            font-size: 0.9rem;
            color: #558b2f;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .result-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2e7d32;
            margin: 10px 0;
        }

        .result-detail {
            font-size: 0.95rem;
            color: #2e7d32;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #c5e1a5;
        }

        .result-detail strong {
            color: #2e7d32;
        }

        .btn-container {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8bc34a 0%, #689f38 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(139, 195, 74, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #a5d6a7 0%, #81c784 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(165, 214, 167, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .note-prep {
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
            padding: 12px;
            border-radius: 0 8px 8px 0;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #6a1b9a;
            display: none;
        }

        .note-prep.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @media (max-width: 600px) {
            .calculator {
                padding: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .result-value {
                font-size: 1.8rem;
            }

            .btn-container {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 12px;
                font-size: 1.05rem;
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìÖ Fechado QCC</h1>
            <p class="subtitle">Selecciona tu insumo y calcula la fecha de vencimiento</p>
        </header>

        <div class="calculator">
            <div class="form-group">
                <label>üîç Selecciona el insumo:</label>
                
                <div class="switch-container">
                    <button class="switch-btn active" id="btnBuscar">üîé Buscador</button>
                    <button class="switch-btn" id="btnLista">üìã Lista Desplegable</button>
                </div>

                <!-- Buscador -->
                <div class="input-section active" id="sectionBuscar">
                    <div class="search-container">
                        <input 
                            type="text" 
                            id="insumoSearch" 
                            placeholder="Ej: Alitas de pollo, Queso Mozzarella..."
                            autocomplete="off"
                        >
                        <div class="suggestions" id="suggestions"></div>
                    </div>
                </div>

                <!-- Lista desplegable -->
                <div class="input-section" id="sectionLista">
                    <select id="insumoSelect">
                        <option value="">Selecciona un insumo...</option>
                        <optgroup label="ü•© C√ÅRNICOS EN TROZOS Y RODAJAS">
                            <option value="0">Alitas de pollo - local (7 d√≠as)</option>
                            <option value="1">Poppers de pollo (7 d√≠as)</option>
                            <option value="2">Pollo asado - importado (10 d√≠as)</option>
                            <option value="3">Salchicha italiana (12 d√≠as)</option>
                            <option value="4">Chorizo - local (7 d√≠as)</option>
                            <option value="5">Chorizo Parrillero (Seg√∫n empaque)</option>
                            <option value="6">Carne de res - local (12 d√≠as)</option>
                            <option value="7">Salchicha de cerdo (12 d√≠as)</option>
                            <option value="8">Tocino (30 d√≠as)</option>
                            <option value="9">Pepperoni de cerdo (30 d√≠as)</option>
                            <option value="10">Jam√≥n - local (14 d√≠as)</option>
                        </optgroup>
                        <optgroup label="üßÄ QUESOS">
                            <option value="11">Queso Mozzarella (14 d√≠as)</option>
                            <option value="12">Queso en tiras (14 d√≠as)</option>
                            <option value="13">Mezcla de 3 quesos (7 d√≠as)</option>
                            <option value="14">Mezcla de 2 quesos (7 d√≠as)</option>
                        </optgroup>
                        <optgroup label="ü•¨ FRUTAS Y VEGETALES">
                            <option value="15">Champi√±√≥n (Seg√∫n empaque)</option>
                            <option value="16">Cebolla blanca/roja (Seg√∫n empaque)</option>
                            <option value="17">Pimiento rojo (Seg√∫n empaque)</option>
                            <option value="18">Pimiento verde (Seg√∫n empaque)</option>
                            <option value="19">Tomate (Seg√∫n empaque)</option>
                            <option value="20">Jalape√±os (Seg√∫n empaque)</option>
                            <option value="21">Aceituna negra (Seg√∫n empaque)</option>
                            <option value="22">Aceituna verde (Seg√∫n empaque)</option>
                            <option value="23">Pi√±a - lata (Seg√∫n empaque)</option>
                            <option value="24">Pepperoncini (Seg√∫n empaque)</option>
                        </optgroup>
                        <optgroup label="ü•´ SALSAS">
                            <option value="25">Salsa pizza - lata (Seg√∫n empaque)</option>
                            <option value="26">Salsa de mayonesa con aj√≠ limo (Seg√∫n empaque)</option>
                            <option value="27">Salsa rosada 1kg (Seg√∫n empaque)</option>
                            <option value="28">Salsa rosada 0.5kg (Seg√∫n empaque)</option>
                            <option value="29">Salsa Parrillera (Seg√∫n empaque)</option>
                            <option value="30">Salsa de ajo - granel (Seg√∫n empaque)</option>
                            <option value="31">Salsa de mango habanero (Seg√∫n empaque)</option>
                            <option value="32">Salsa Ranch (Seg√∫n empaque)</option>
                            <option value="33">Salsa Bechamel (Seg√∫n empaque)</option>
                            <option value="34">Salsa Chimichurri (Seg√∫n empaque)</option>
                            <option value="35">Salsa de ajo - cup (Seg√∫n empaque)</option>
                            <option value="36">Salsa Parmesana - granel (Seg√∫n empaque)</option>
                            <option value="37">Salsa BBQ - cup (Seg√∫n empaque)</option>
                            <option value="38">Salsa BBQ - bolsa (Seg√∫n empaque)</option>
                            <option value="39">Salsa Buffalo - cup (Seg√∫n empaque)</option>
                            <option value="40">Salsa de Miel Picante (Seg√∫n empaque)</option>
                        </optgroup>
                        <optgroup label="üì¶ OTROS INSUMOS">
                            <option value="41">Dustinator (Seg√∫n empaque)</option>
                            <option value="42">Masa Croisant (5 d√≠as)</option>
                            <option value="43">Masa delgada - importada (30 d√≠as)</option>
                            <option value="44">Az√∫car glaseada - local (Seg√∫n empaque)</option>
                            <option value="45">Cinamon Spreed (Seg√∫n empaque)</option>
                            <option value="46">Or√©gano - sachet (Seg√∫n empaque)</option>
                            <option value="47">Aji panca - sachet (Seg√∫n empaque)</option>
                            <option value="48">Or√©gano - granel (Seg√∫n empaque)</option>
                            <option value="49">Aji panca - granel (Seg√∫n empaque)</option>
                            <option value="50">Sazonador italiano (Seg√∫n empaque)</option>
                            <option value="51">Pasta de lasagna (10 d√≠as)</option>
                            <option value="52">Tortilla (Seg√∫n empaque)</option>
                            <option value="53">Manjar Blanco (Seg√∫n empaque)</option>
                            <option value="54">Az√∫car Impalpable (Seg√∫n empaque)</option>
                        </optgroup>
                        <optgroup label="üçù PREPS (Preparaciones)">
                            <option value="55">Lasagna - Preparaci√≥n interna</option>
                            <option value="56">Rollitos de Pepperoni/Jam√≥n - Preparaci√≥n interna</option>
                            <option value="57">Rollitos de Manjar - Preparaci√≥n interna</option>
                            <option value="58">Rollitos de Canela - Preparaci√≥n interna</option>
                        </optgroup>
                    </select>
                </div>

                <div class="note-prep" id="notePrep">
                    üí° Los PREPS son preparaciones internas. Su vencimiento se calcula al momento de prepararlos, no al recibir insumos.
                </div>
            </div>

            <div class="form-group">
                <label for="fechaIngreso">üìÜ Fecha de ingreso/recepci√≥n:</label>
                <input type="date" id="fechaIngreso">
            </div>

            <div class="btn-container">
                <button class="btn btn-primary" id="calcularBtn">
                    <span>‚úÖ</span> CALCULAR VENCIMIENTO
                </button>
                <button class="btn btn-secondary" id="limpiarBtn">
                    <span>üßπ</span> LIMPIAR
                </button>
            </div>

            <div class="result-box" id="resultBox">
                <div class="result-title">‚ú® Fecha de Vencimiento</div>
                <div class="result-value" id="fechaVencimiento">--/--/----</div>
                <div class="result-detail">
                    <div><strong id="insumoNombre">-</strong></div>
                    <div>‚è±Ô∏è Vida √∫til: <strong id="vidaUtilText">-</strong></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Base de datos de insumos - con manejo especial para PREPS
        const insumosDB = [
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Alitas de pollo - local", vidaUtil: 7, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Poppers de pollo", vidaUtil: 7, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Pollo asado - importado", vidaUtil: 10, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Salchicha italiana", vidaUtil: 12, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Chorizo - local", vidaUtil: 7, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Chorizo Parrillero", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Carne de res - local", vidaUtil: 12, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Salchicha de cerdo", vidaUtil: 12, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Tocino", vidaUtil: 30, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Pepperoni de cerdo", vidaUtil: 30, tipo: "normal"},
            {categoria: "ü•© C√ÅRNICOS EN TROZOS Y RODAJAS", nombre: "Jam√≥n - local", vidaUtil: 14, tipo: "normal"},
            {categoria: "üßÄ QUESOS", nombre: "Queso Mozzarella", vidaUtil: 14, tipo: "normal"},
            {categoria: "üßÄ QUESOS", nombre: "Queso en tiras", vidaUtil: 14, tipo: "normal"},
            {categoria: "üßÄ QUESOS", nombre: "Mezcla de 3 quesos (Asiago, Fontina, Provolone)", vidaUtil: 7, tipo: "normal"},
            {categoria: "üßÄ QUESOS", nombre: "Mezcla de 2 quesos (Romano y Parmesano)", vidaUtil: 7, tipo: "normal"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Champi√±√≥n", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Cebolla blanca/roja", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Pimiento rojo", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Pimiento verde", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Tomate", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Jalape√±os", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Aceituna negra", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Aceituna verde", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Pi√±a - lata", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•¨ FRUTAS Y VEGETALES", nombre: "Pepperoncini", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa pizza - lata", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa de mayonesa con aj√≠ limo", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa rosada (1kg)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa rosada (0.5 kg)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa Parrillera", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa de ajo (botella - granel)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa de mango habanero (bolsa)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa Ranch", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa Bechamel", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa Chimichurri", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa de ajo (blister - cup)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa Parmesana (botella - granel)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa BBQ (blister - cup)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa BBQ (bolsa)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa Buffalo (blister - cup)", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "ü•´ SALSAS", nombre: "Salsa de Miel Picante", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Dustinator", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Masa Croisant", vidaUtil: 5, tipo: "normal"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Masa delgada - importada", vidaUtil: 30, tipo: "normal"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Az√∫car glaseada (Icing) - local", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Cinamon Spreed", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Or√©gano - sachet", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Aji panca - sachet", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Or√©gano - granel", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Aji panca - granel", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Sazonador italiano", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Pasta de lasagna", vidaUtil: 10, tipo: "normal"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Tortilla", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Manjar Blanco", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üì¶ OTROS INSUMOS", nombre: "Az√∫car Impalpable", vidaUtil: "Seg√∫n empaque", tipo: "empaque"},
            {categoria: "üçù PREPS", nombre: "Lasagna (All the meats/The Works/Americana)", vidaUtil: null, tipo: "prep"},
            {categoria: "üçù PREPS", nombre: "Rollitos de Pepperoni/Jam√≥n", vidaUtil: null, tipo: "prep"},
            {categoria: "üçù PREPS", nombre: "Rollitos de Manjar", vidaUtil: null, tipo: "prep"},
            {categoria: "üçù PREPS", nombre: "Rollitos de Canela", vidaUtil: null, tipo: "prep"}
        ];

        // Variables
        let selectedInsumo = null;
        let modoBusqueda = true; // true = buscador, false = lista

        // DOM Elements
        const insumoSearch = document.getElementById('insumoSearch');
        const insumoSelect = document.getElementById('insumoSelect');
        const suggestions = document.getElementById('suggestions');
        const calcularBtn = document.getElementById('calcularBtn');
        const limpiarBtn = document.getElementById('limpiarBtn');
        const resultBox = document.getElementById('resultBox');
        const fechaVencimiento = document.getElementById('fechaVencimiento');
        const insumoNombre = document.getElementById('insumoNombre');
        const vidaUtilText = document.getElementById('vidaUtilText');
        const btnBuscar = document.getElementById('btnBuscar');
        const btnLista = document.getElementById('btnLista');
        const sectionBuscar = document.getElementById('sectionBuscar');
        const sectionLista = document.getElementById('sectionLista');
        const fechaIngreso = document.getElementById('fechaIngreso');
        const notePrep = document.getElementById('notePrep');

        // Event Listeners
        insumoSearch.addEventListener('input', showSuggestions);
        insumoSearch.addEventListener('click', showSuggestions);
        document.addEventListener('click', hideSuggestionsOnClickOutside);
        calcularBtn.addEventListener('click', calcularVencimiento);
        limpiarBtn.addEventListener('click', limpiarTodo);
        insumoSelect.addEventListener('change', onListaChange);
        btnBuscar.addEventListener('click', () => switchMode(true));
        btnLista.addEventListener('click', () => switchMode(false));

        // Funciones
        function switchMode(busqueda) {
            modoBusqueda = busqueda;
            
            if (busqueda) {
                btnBuscar.classList.add('active');
                btnLista.classList.remove('active');
                sectionBuscar.classList.add('active');
                sectionLista.classList.remove('active');
            } else {
                btnBuscar.classList.remove('active');
                btnLista.classList.add('active');
                sectionBuscar.classList.remove('active');
                sectionLista.classList.add('active');
            }
            
            // Limpiar selecci√≥n y resultado al cambiar de modo
            limpiarTodo();
        }

        function showSuggestions() {
            const searchTerm = insumoSearch.value.toLowerCase();
            
            if (searchTerm.length === 0) {
                suggestions.style.display = 'none';
                notePrep.classList.remove('active');
                return;
            }

            const filtered = insumosDB.filter(insumo => 
                insumo.nombre.toLowerCase().includes(searchTerm) ||
                insumo.categoria.toLowerCase().includes(searchTerm)
            );

            if (filtered.length === 0) {
                suggestions.innerHTML = '<div class="suggestion-item">No se encontraron resultados</div>';
                suggestions.style.display = 'block';
                notePrep.classList.remove('active');
                return;
            }

            suggestions.innerHTML = filtered.map(insumo => {
                let vidaUtilText = '';
                let emoji = '';
                
                if (insumo.tipo === 'prep') {
                    vidaUtilText = 'Preparaci√≥n interna';
                    emoji = 'üçù';
                } else if (insumo.tipo === 'empaque') {
                    vidaUtilText = 'Seg√∫n empaque';
                    emoji = 'üì¶';
                } else {
                    vidaUtilText = insumo.vidaUtil + ' d√≠as';
                    emoji = '‚úÖ';
                }
                
                return `
                    <div class="suggestion-item" onclick="selectInsumo('${insumo.nombre.replace(/'/g, "\\'")}')">
                        <strong>${insumo.categoria}</strong>
                        <span>${emoji} ${insumo.nombre}</span>
                        <div style="font-size: 0.8rem; color: #689f38; margin-top: 3px;">
                            ${vidaUtilText}
                        </div>
                    </div>
                `;
            }).join('');

            suggestions.style.display = 'block';
        }

        function hideSuggestionsOnClickOutside(e) {
            if (!e.target.closest('.search-container')) {
                suggestions.style.display = 'none';
            }
        }

        function selectInsumo(nombre) {
            selectedInsumo = insumosDB.find(i => i.nombre === nombre);
            insumoSearch.value = nombre;
            suggestions.style.display = 'none';
            
            // Mostrar nota si es PREP
            if (selectedInsumo && selectedInsumo.tipo === 'prep') {
                notePrep.classList.add('active');
            } else {
                notePrep.classList.remove('active');
            }
        }

        function onListaChange() {
            const index = insumoSelect.value;
            if (index !== '') {
                selectedInsumo = insumosDB[parseInt(index)];
                // Mostrar nota si es PREP
                if (selectedInsumo.tipo === 'prep') {
                    notePrep.classList.add('active');
                } else {
                    notePrep.classList.remove('active');
                }
            } else {
                selectedInsumo = null;
                notePrep.classList.remove('active');
            }
        }

        function calcularVencimiento() {
            if (!selectedInsumo) {
                alert('‚ö†Ô∏è Por favor selecciona un insumo primero');
                return;
            }

            if (!fechaIngreso.value) {
                alert('‚ö†Ô∏è Por favor selecciona la fecha de ingreso');
                return;
            }

            let fechaVenc;
            let emojiVenc = 'üìÖ';

            if (selectedInsumo.tipo === 'prep') {
                // Manejo especial para PREPS
                fechaVenc = 'N/A para recepci√≥n';
                vidaUtilText.textContent = 'Preparaci√≥n interna';
                emojiVenc = 'üçù';
            } else if (selectedInsumo.tipo === 'empaque') {
                fechaVenc = 'Seg√∫n empaque';
                vidaUtilText.textContent = 'Seg√∫n empaque';
                emojiVenc = 'üì¶';
            } else {
                // C√°lculo normal
                const fechaIngresoVal = new Date(fechaIngreso.value);
                fechaIngresoVal.setDate(fechaIngresoVal.getDate() + parseInt(selectedInsumo.vidaUtil));
                fechaVenc = formatDate(fechaIngresoVal);
                vidaUtilText.textContent = selectedInsumo.vidaUtil + ' d√≠as';
            }

            // Mostrar resultado
            insumoNombre.textContent = selectedInsumo.nombre;
            fechaVencimiento.textContent = `${emojiVenc} ${fechaVenc}`;
            resultBox.classList.add('active');
        }

        function limpiarTodo() {
            // Limpiar campos
            selectedInsumo = null;
            insumoSearch.value = '';
            insumoSelect.value = '';
            suggestions.style.display = 'none';
            notePrep.classList.remove('active');
            
            // Restablecer fecha actual
            fechaIngreso.value = '';
            
            // Ocultar resultado
            resultBox.classList.remove('active');
            insumoNombre.textContent = '-';
            vidaUtilText.textContent = '-';
            fechaVencimiento.textContent = '--/--/----';
        }

        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }

        // Exponer funci√≥n global para onclick
        window.selectInsumo = selectInsumo;
    </script>
</body>
</html>
